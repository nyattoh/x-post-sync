/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
Please visit the GitHub repository for the source code: https://github.com/YOUR_USERNAME/x-posts-sync (UPDATE THIS LINK)
*/

'use strict';

var obsidian = require('obsidian');

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */


function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, [])).next());
    });
}

function fetchUserId(username, requestUrl, bearerToken) {
    return __awaiter(this, void 0, void 0, function* () {
        var _a, _b;
        // Try X API v2 first if bearer token is available
        if (bearerToken) {
            const apiUrl = `https://api.x.com/2/users/by/username/${encodeURIComponent(username)}`;
            try {
                const res = yield requestUrl({
                    url: apiUrl,
                    headers: { Authorization: `Bearer ${bearerToken}` }
                });
                let jsonData;
                if (res.json) {
                    jsonData = res.json;
                }
                else if (res.text) {
                    try {
                        jsonData = JSON.parse(res.text);
                    }
                    catch (parseError) {
                        throw new Error(`Invalid JSON response from X API: ${res.text}`);
                    }
                }
                else {
                    throw new Error("Empty response from X API");
                }
                if ((_a = jsonData === null || jsonData === void 0 ? void 0 : jsonData.data) === null || _a === void 0 ? void 0 : _a.id) {
                    return String(jsonData.data.id);
                }
                if (jsonData === null || jsonData === void 0 ? void 0 : jsonData.errors) {
                    console.log("X API v2 errors, falling back to syndication:", jsonData.errors);
                }
            }
            catch (apiError) {
                console.log("X API v2 failed, trying syndication endpoint:", apiError.message);
            }
        }
        // Fallback to syndication API (no auth required)
        const syndicationUrl = "https://cdn.syndication.twimg.com/widgets/followbutton/info.json?screen_names=" + encodeURIComponent(username);
        try {
            const res = yield requestUrl({ url: syndicationUrl });
            // Handle different response formats
            let jsonData;
            if (res.json) {
                jsonData = res.json;
            }
            else if (res.text) {
                if (!res.text.trim()) {
                    throw new Error("Empty response from syndication API");
                }
                try {
                    jsonData = JSON.parse(res.text);
                }
                catch (parseError) {
                    throw new Error(`Invalid JSON response from syndication API: ${res.text}`);
                }
            }
            else {
                throw new Error("Empty response from syndication API");
            }
            // Ensure jsonData is an array
            const data = Array.isArray(jsonData) ? jsonData : [jsonData];
            const id = (_b = data[0]) === null || _b === void 0 ? void 0 : _b.id;
            if (!id) {
                throw new Error(`User ID not found for username: ${username}`);
            }
            return String(id);
        }
        catch (error) {
            throw new Error(`Failed to fetch user ID: ${error.message}`);
        }
    });
}
function fetchTweets(userId, bearer, requestUrl) {
    return __awaiter(this, void 0, void 0, function* () {
        var _a, _b;
        const url = `https://api.x.com/2/users/${userId}/tweets?max_results=100&exclude=replies&tweet.fields=created_at,referenced_tweets`;
        try {
            const res = yield requestUrl({
                url,
                headers: { Authorization: `Bearer ${bearer}` }
            });
            // Handle rate limit 429 error specifically
            if (res.status === 429) {
                const resetTime = (_a = res.headers) === null || _a === void 0 ? void 0 : _a['x-rate-limit-reset'];
                const resetTimeStr = resetTime ? new Date(parseInt(resetTime) * 1000).toLocaleString() : 'unknown';
                throw new Error(`Rate limit exceeded. Free tier: 100 reads/month. Reset: ${resetTimeStr}`);
            }
            // Handle different response formats
            let jsonData;
            if (res.json) {
                jsonData = res.json;
            }
            else if (res.text) {
                try {
                    jsonData = JSON.parse(res.text);
                }
                catch (parseError) {
                    throw new Error(`Invalid JSON response from X API: ${res.text}`);
                }
            }
            else {
                throw new Error("Empty response from X API");
            }
            // Check for API errors
            if (jsonData.errors) {
                const errorMsg = jsonData.errors.map((e) => e.message || e.detail).join(", ");
                throw new Error(`X API Error: ${errorMsg}`);
            }
            return (_b = jsonData.data) !== null && _b !== void 0 ? _b : [];
        }
        catch (error) {
            // Check if this is a rate limit error from Obsidian's requestUrl
            if (error.message && error.message.includes("status 429")) {
                throw new Error("Rate limit exceeded. Free tier: 100 reads/month. Please wait before trying again.");
            }
            // Check if the error has a status property indicating 429
            if (error.status === 429) {
                throw new Error("Rate limit exceeded. Free tier: 100 reads/month. Wait 15 minutes or check monthly usage.");
            }
            throw new Error(`Failed to fetch tweets: ${error.message}`);
        }
    });
}
function tweetToMarkdown(t) {
    var _a, _b, _c;
    const rt = (_c = (_b = (_a = t.referenced_tweets) === null || _a === void 0 ? void 0 : _a.find(r => r.type === "retweeted")) === null || _b === void 0 ? void 0 : _b.id) !== null && _c !== void 0 ? _c : "";
    return [
        "---",
        `id: ${t.id}`,
        `created_at: ${t.created_at}`,
        rt ? `retweeted_id: ${rt}` : "",
        "---",
        t.text,
        ""
    ].join("\n");
}

const DEFAULT_SETTINGS = {
    bearerToken: "",
    username: "",
    cachedUserId: "",
    interval: 60,
    monthlyRequestCount: 0,
    lastResetDate: ""
};
function checkMonthlyReset(settings) {
    const now = new Date();
    const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
    if (settings.lastResetDate !== currentMonth) {
        settings.monthlyRequestCount = 0;
        settings.lastResetDate = currentMonth;
        return true; // Reset occurred
    }
    return false; // No reset needed
}

class XPostsSync extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
            this.addSettingTab(new Tab(this.app, this));
            this.addRibbonIcon("bookmark-star", "Sync My Posts", () => this.sync());
            this.status = this.addStatusBarItem();
            this.status.setText("XPostsSync ⏳ init");
            setTimeout(() => this.sync(), 2000);
            this.registerInterval(window.setInterval(() => this.sync(), this.settings.interval * 60000));
        });
    }
    onunload() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.sync();
            this.status.setText("XPostsSync 🛑 off");
        });
    }
    sync() {
        return __awaiter(this, void 0, void 0, function* () {
            const { bearerToken, username } = this.settings;
            if (!bearerToken || !username) {
                this.status.setText("XPostsSync ⚠ 未設定");
                return;
            }
            // Check and handle monthly reset
            const wasReset = checkMonthlyReset(this.settings);
            if (wasReset) {
                yield this.saveData(this.settings);
            }
            // Check monthly limit before making request
            if (this.settings.monthlyRequestCount >= 100) {
                this.status.setText("❌ 月次制限到達");
                new obsidian.Notice("X API月次制限(100 reads)に到達しました。翌月まで待機してください。");
                return;
            }
            try {
                if (!this.settings.cachedUserId) {
                    this.settings.cachedUserId = yield fetchUserId(username, obsidian.requestUrl, bearerToken);
                    yield this.saveData(this.settings);
                }
                const tweets = yield fetchTweets(this.settings.cachedUserId, bearerToken, obsidian.requestUrl);
                // Increment usage counter on successful API call
                this.settings.monthlyRequestCount++;
                yield this.saveData(this.settings);
                let n = 0;
                const a = this.app.vault.adapter;
                for (const t of tweets) {
                    const dir = `${t.created_at.slice(0, 10).replace(/-/g, "/")}/`;
                    const path = `${dir}${t.id}.md`;
                    if (yield a.exists(path))
                        continue;
                    yield a.mkdir(dir).catch(() => { });
                    yield a.write(path, tweetToMarkdown(t));
                    n++;
                }
                this.status.setText(`XPostsSync ✅ ${n} (${this.settings.monthlyRequestCount}/100)`);
            }
            catch (e) {
                console.error(e);
                if (e.message && e.message.includes("Rate limit exceeded")) {
                    this.status.setText("⏰ Rate limit");
                    new obsidian.Notice("Rate limit到達。15分後に再試行してください。");
                }
                else {
                    new obsidian.Notice("XPostsSync error: " + e.message);
                    this.status.setText("XPostsSync ❌ error");
                }
            }
        });
    }
}
class Tab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        const c = this.containerEl;
        c.empty();
        c.createEl("h3", { text: "X Posts Sync" });
        new obsidian.Setting(c)
            .setName("📊 X API使用状況")
            .setDesc(`今月の使用量: ${this.plugin.settings.monthlyRequestCount}/100 reads`);
        new obsidian.Setting(c)
            .setName("⚠️ Free Tier制限")
            .setDesc("月100リクエストまで。超過時は翌月まで待機が必要です。");
        new obsidian.Setting(c)
            .setName("Bearer Token")
            .addText(t => t
            .setValue(this.plugin.settings.bearerToken)
            .onChange((v) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.bearerToken = v.trim();
            yield this.plugin.saveData(this.plugin.settings);
        })));
        new obsidian.Setting(c)
            .setName("Username (@無し)")
            .addText(t => t
            .setValue(this.plugin.settings.username)
            .onChange((v) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.username = v.trim();
            this.plugin.settings.cachedUserId = "";
            yield this.plugin.saveData(this.plugin.settings);
        })));
        new obsidian.Setting(c)
            .setName("Interval (min)")
            .addText(t => t
            .setValue(String(this.plugin.settings.interval))
            .onChange((v) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.interval = parseInt(v) || 60;
            yield this.plugin.saveData(this.plugin.settings);
        })));
    }
}

module.exports = XPostsSync;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsiLi4vbm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIi4uL3NyYy9jb3JlLnRzIiwiLi4vc3JjL3NldHRpbmdzLnRzIiwiLi4vc3JjL21haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVzdChzLCBlKSB7XHJcbiAgICB2YXIgdCA9IHt9O1xyXG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXHJcbiAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXHJcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgICAgICB9XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7XHJcbiAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xyXG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEluKHN0YXRlLCByZWNlaXZlcikge1xyXG4gICAgaWYgKHJlY2VpdmVyID09PSBudWxsIHx8ICh0eXBlb2YgcmVjZWl2ZXIgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHJlY2VpdmVyICE9PSBcImZ1bmN0aW9uXCIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHVzZSAnaW4nIG9wZXJhdG9yIG9uIG5vbi1vYmplY3RcIik7XHJcbiAgICByZXR1cm4gdHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpO1xyXG59XHJcbiIsImltcG9ydCB0eXBlIHsgUmVxdWVzdFVybFBhcmFtIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFR3ZWV0IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHRleHQ6IHN0cmluZztcclxuICBjcmVhdGVkX2F0OiBzdHJpbmc7XHJcbiAgcmVmZXJlbmNlZF90d2VldHM/OiB7IGlkOiBzdHJpbmc7IHR5cGU6IHN0cmluZyB9W107XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJJZChcclxuICB1c2VybmFtZTogc3RyaW5nLFxyXG4gIHJlcXVlc3RVcmw6IChwOiBSZXF1ZXN0VXJsUGFyYW0pID0+IFByb21pc2U8YW55PixcclxuICBiZWFyZXJUb2tlbj86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIC8vIFRyeSBYIEFQSSB2MiBmaXJzdCBpZiBiZWFyZXIgdG9rZW4gaXMgYXZhaWxhYmxlXHJcbiAgaWYgKGJlYXJlclRva2VuKSB7XHJcbiAgICBjb25zdCBhcGlVcmwgPSBgaHR0cHM6Ly9hcGkueC5jb20vMi91c2Vycy9ieS91c2VybmFtZS8ke2VuY29kZVVSSUNvbXBvbmVudCh1c2VybmFtZSl9YDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdFVybCh7XHJcbiAgICAgICAgdXJsOiBhcGlVcmwsXHJcbiAgICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YmVhcmVyVG9rZW59YCB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgbGV0IGpzb25EYXRhO1xyXG4gICAgICBpZiAocmVzLmpzb24pIHtcclxuICAgICAgICBqc29uRGF0YSA9IHJlcy5qc29uO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlcy50ZXh0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGpzb25EYXRhID0gSlNPTi5wYXJzZShyZXMudGV4dCk7XHJcbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEpTT04gcmVzcG9uc2UgZnJvbSBYIEFQSTogJHtyZXMudGV4dH1gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW1wdHkgcmVzcG9uc2UgZnJvbSBYIEFQSVwiKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKGpzb25EYXRhPy5kYXRhPy5pZCkge1xyXG4gICAgICAgIHJldHVybiBTdHJpbmcoanNvbkRhdGEuZGF0YS5pZCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChqc29uRGF0YT8uZXJyb3JzKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJYIEFQSSB2MiBlcnJvcnMsIGZhbGxpbmcgYmFjayB0byBzeW5kaWNhdGlvbjpcIiwganNvbkRhdGEuZXJyb3JzKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoYXBpRXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIlggQVBJIHYyIGZhaWxlZCwgdHJ5aW5nIHN5bmRpY2F0aW9uIGVuZHBvaW50OlwiLCBhcGlFcnJvci5tZXNzYWdlKTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLy8gRmFsbGJhY2sgdG8gc3luZGljYXRpb24gQVBJIChubyBhdXRoIHJlcXVpcmVkKVxyXG4gIGNvbnN0IHN5bmRpY2F0aW9uVXJsID0gXCJodHRwczovL2Nkbi5zeW5kaWNhdGlvbi50d2ltZy5jb20vd2lkZ2V0cy9mb2xsb3didXR0b24vaW5mby5qc29uP3NjcmVlbl9uYW1lcz1cIiArIGVuY29kZVVSSUNvbXBvbmVudCh1c2VybmFtZSk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RVcmwoeyB1cmw6IHN5bmRpY2F0aW9uVXJsIH0pO1xyXG4gICAgXHJcbiAgICAvLyBIYW5kbGUgZGlmZmVyZW50IHJlc3BvbnNlIGZvcm1hdHNcclxuICAgIGxldCBqc29uRGF0YTtcclxuICAgIGlmIChyZXMuanNvbikge1xyXG4gICAgICBqc29uRGF0YSA9IHJlcy5qc29uO1xyXG4gICAgfSBlbHNlIGlmIChyZXMudGV4dCkge1xyXG4gICAgICBpZiAoIXJlcy50ZXh0LnRyaW0oKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtcHR5IHJlc3BvbnNlIGZyb20gc3luZGljYXRpb24gQVBJXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAganNvbkRhdGEgPSBKU09OLnBhcnNlKHJlcy50ZXh0KTtcclxuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBKU09OIHJlc3BvbnNlIGZyb20gc3luZGljYXRpb24gQVBJOiAke3Jlcy50ZXh0fWApO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbXB0eSByZXNwb25zZSBmcm9tIHN5bmRpY2F0aW9uIEFQSVwiKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRW5zdXJlIGpzb25EYXRhIGlzIGFuIGFycmF5XHJcbiAgICBjb25zdCBkYXRhID0gQXJyYXkuaXNBcnJheShqc29uRGF0YSkgPyBqc29uRGF0YSA6IFtqc29uRGF0YV07XHJcbiAgICBjb25zdCBpZCA9IGRhdGFbMF0/LmlkO1xyXG4gICAgXHJcbiAgICBpZiAoIWlkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVXNlciBJRCBub3QgZm91bmQgZm9yIHVzZXJuYW1lOiAke3VzZXJuYW1lfWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gU3RyaW5nKGlkKTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCB1c2VyIElEOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hUd2VldHMoXHJcbiAgdXNlcklkOiBzdHJpbmcsXHJcbiAgYmVhcmVyOiBzdHJpbmcsXHJcbiAgcmVxdWVzdFVybDogKHA6IFJlcXVlc3RVcmxQYXJhbSkgPT4gUHJvbWlzZTxhbnk+XHJcbik6IFByb21pc2U8VHdlZXRbXT4ge1xyXG4gIGNvbnN0IHVybCA9IGBodHRwczovL2FwaS54LmNvbS8yL3VzZXJzLyR7dXNlcklkfS90d2VldHM/bWF4X3Jlc3VsdHM9MTAwJmV4Y2x1ZGU9cmVwbGllcyZ0d2VldC5maWVsZHM9Y3JlYXRlZF9hdCxyZWZlcmVuY2VkX3R3ZWV0c2A7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RVcmwoe1xyXG4gICAgICB1cmwsXHJcbiAgICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2JlYXJlcn1gIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBIYW5kbGUgcmF0ZSBsaW1pdCA0MjkgZXJyb3Igc3BlY2lmaWNhbGx5XHJcbiAgICBpZiAocmVzLnN0YXR1cyA9PT0gNDI5KSB7XHJcbiAgICAgIGNvbnN0IHJlc2V0VGltZSA9IHJlcy5oZWFkZXJzPy5bJ3gtcmF0ZS1saW1pdC1yZXNldCddO1xyXG4gICAgICBjb25zdCByZXNldFRpbWVTdHIgPSByZXNldFRpbWUgPyBuZXcgRGF0ZShwYXJzZUludChyZXNldFRpbWUpICogMTAwMCkudG9Mb2NhbGVTdHJpbmcoKSA6ICd1bmtub3duJztcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSYXRlIGxpbWl0IGV4Y2VlZGVkLiBGcmVlIHRpZXI6IDEwMCByZWFkcy9tb250aC4gUmVzZXQ6ICR7cmVzZXRUaW1lU3RyfWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBIYW5kbGUgZGlmZmVyZW50IHJlc3BvbnNlIGZvcm1hdHNcclxuICAgIGxldCBqc29uRGF0YTtcclxuICAgIGlmIChyZXMuanNvbikge1xyXG4gICAgICBqc29uRGF0YSA9IHJlcy5qc29uO1xyXG4gICAgfSBlbHNlIGlmIChyZXMudGV4dCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGpzb25EYXRhID0gSlNPTi5wYXJzZShyZXMudGV4dCk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgSlNPTiByZXNwb25zZSBmcm9tIFggQVBJOiAke3Jlcy50ZXh0fWApO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbXB0eSByZXNwb25zZSBmcm9tIFggQVBJXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDaGVjayBmb3IgQVBJIGVycm9yc1xyXG4gICAgaWYgKGpzb25EYXRhLmVycm9ycykge1xyXG4gICAgICBjb25zdCBlcnJvck1zZyA9IGpzb25EYXRhLmVycm9ycy5tYXAoKGU6IGFueSkgPT4gZS5tZXNzYWdlIHx8IGUuZGV0YWlsKS5qb2luKFwiLCBcIik7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgWCBBUEkgRXJyb3I6ICR7ZXJyb3JNc2d9YCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBqc29uRGF0YS5kYXRhID8/IFtdO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSByYXRlIGxpbWl0IGVycm9yIGZyb20gT2JzaWRpYW4ncyByZXF1ZXN0VXJsXHJcbiAgICBpZiAoZXJyb3IubWVzc2FnZSAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwic3RhdHVzIDQyOVwiKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSYXRlIGxpbWl0IGV4Y2VlZGVkLiBGcmVlIHRpZXI6IDEwMCByZWFkcy9tb250aC4gUGxlYXNlIHdhaXQgYmVmb3JlIHRyeWluZyBhZ2Fpbi5cIik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGlmIHRoZSBlcnJvciBoYXMgYSBzdGF0dXMgcHJvcGVydHkgaW5kaWNhdGluZyA0MjlcclxuICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQyOSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSYXRlIGxpbWl0IGV4Y2VlZGVkLiBGcmVlIHRpZXI6IDEwMCByZWFkcy9tb250aC4gV2FpdCAxNSBtaW51dGVzIG9yIGNoZWNrIG1vbnRobHkgdXNhZ2UuXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCB0d2VldHM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0d2VldFRvTWFya2Rvd24odDogVHdlZXQpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHJ0ID0gdC5yZWZlcmVuY2VkX3R3ZWV0cz8uZmluZChyID0+IHIudHlwZSA9PT0gXCJyZXR3ZWV0ZWRcIik/LmlkID8/IFwiXCI7XHJcbiAgcmV0dXJuIFtcclxuICAgIFwiLS0tXCIsXHJcbiAgICBgaWQ6ICR7dC5pZH1gLFxyXG4gICAgYGNyZWF0ZWRfYXQ6ICR7dC5jcmVhdGVkX2F0fWAsXHJcbiAgICBydCA/IGByZXR3ZWV0ZWRfaWQ6ICR7cnR9YCA6IFwiXCIsXHJcbiAgICBcIi0tLVwiLFxyXG4gICAgdC50ZXh0LFxyXG4gICAgXCJcIlxyXG4gIF0uam9pbihcIlxcblwiKTtcclxufSIsImV4cG9ydCBpbnRlcmZhY2UgWFN5bmNTZXR0aW5ncyB7XHJcbiAgYmVhcmVyVG9rZW46IHN0cmluZztcclxuICB1c2VybmFtZTogc3RyaW5nO1xyXG4gIGNhY2hlZFVzZXJJZDogc3RyaW5nO1xyXG4gIGludGVydmFsOiBudW1iZXI7XHJcbiAgbW9udGhseVJlcXVlc3RDb3VudDogbnVtYmVyO1xyXG4gIGxhc3RSZXNldERhdGU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFhTeW5jU2V0dGluZ3MgPSB7XHJcbiAgYmVhcmVyVG9rZW46IFwiXCIsXHJcbiAgdXNlcm5hbWU6IFwiXCIsXHJcbiAgY2FjaGVkVXNlcklkOiBcIlwiLFxyXG4gIGludGVydmFsOiA2MCxcclxuICBtb250aGx5UmVxdWVzdENvdW50OiAwLFxyXG4gIGxhc3RSZXNldERhdGU6IFwiXCJcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjaGVja01vbnRobHlSZXNldChzZXR0aW5nczogWFN5bmNTZXR0aW5ncyk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgY29uc3QgY3VycmVudE1vbnRoID0gYCR7bm93LmdldEZ1bGxZZWFyKCl9LSR7bm93LmdldE1vbnRoKCl9YDtcclxuICBcclxuICBpZiAoc2V0dGluZ3MubGFzdFJlc2V0RGF0ZSAhPT0gY3VycmVudE1vbnRoKSB7XHJcbiAgICBzZXR0aW5ncy5tb250aGx5UmVxdWVzdENvdW50ID0gMDtcclxuICAgIHNldHRpbmdzLmxhc3RSZXNldERhdGUgPSBjdXJyZW50TW9udGg7XHJcbiAgICByZXR1cm4gdHJ1ZTsgLy8gUmVzZXQgb2NjdXJyZWRcclxuICB9XHJcbiAgcmV0dXJuIGZhbHNlOyAvLyBObyByZXNldCBuZWVkZWRcclxufSIsImltcG9ydCB7IFBsdWdpbiwgQXBwLCByZXF1ZXN0VXJsLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBOb3RpY2UgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgZmV0Y2hVc2VySWQsIGZldGNoVHdlZXRzLCB0d2VldFRvTWFya2Rvd24gfSBmcm9tIFwiLi9jb3JlXCI7XHJcbmltcG9ydCB0eXBlIHsgWFN5bmNTZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCB7IERFRkFVTFRfU0VUVElOR1MsIGNoZWNrTW9udGhseVJlc2V0IH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFhQb3N0c1N5bmMgZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIHNldHRpbmdzITogWFN5bmNTZXR0aW5ncztcclxuICBzdGF0dXMhOiBIVE1MRWxlbWVudDtcclxuXHJcbiAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XHJcbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IFRhYih0aGlzLmFwcCwgdGhpcykpO1xyXG4gICAgdGhpcy5hZGRSaWJib25JY29uKFwiYm9va21hcmstc3RhclwiLCBcIlN5bmMgTXkgUG9zdHNcIiwgKCkgPT4gdGhpcy5zeW5jKCkpO1xyXG4gICAgdGhpcy5zdGF0dXMgPSB0aGlzLmFkZFN0YXR1c0Jhckl0ZW0oKTtcclxuICAgIHRoaXMuc3RhdHVzLnNldFRleHQoXCJYUG9zdHNTeW5jIOKPsyBpbml0XCIpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnN5bmMoKSwgMjAwMCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVySW50ZXJ2YWwod2luZG93LnNldEludGVydmFsKCgpID0+IHRoaXMuc3luYygpLCB0aGlzLnNldHRpbmdzLmludGVydmFsICogNjAwMDApKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIG9udW5sb2FkKCkge1xyXG4gICAgYXdhaXQgdGhpcy5zeW5jKCk7XHJcbiAgICB0aGlzLnN0YXR1cy5zZXRUZXh0KFwiWFBvc3RzU3luYyDwn5uRIG9mZlwiKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHN5bmMoKSB7XHJcbiAgICBjb25zdCB7IGJlYXJlclRva2VuLCB1c2VybmFtZSB9ID0gdGhpcy5zZXR0aW5ncztcclxuICAgIGlmICghYmVhcmVyVG9rZW4gfHwgIXVzZXJuYW1lKSB7XHJcbiAgICAgIHRoaXMuc3RhdHVzLnNldFRleHQoXCJYUG9zdHNTeW5jIOKaoCDmnKroqK3lrppcIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBhbmQgaGFuZGxlIG1vbnRobHkgcmVzZXRcclxuICAgIGNvbnN0IHdhc1Jlc2V0ID0gY2hlY2tNb250aGx5UmVzZXQodGhpcy5zZXR0aW5ncyk7XHJcbiAgICBpZiAod2FzUmVzZXQpIHtcclxuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBtb250aGx5IGxpbWl0IGJlZm9yZSBtYWtpbmcgcmVxdWVzdFxyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MubW9udGhseVJlcXVlc3RDb3VudCA+PSAxMDApIHtcclxuICAgICAgdGhpcy5zdGF0dXMuc2V0VGV4dChcIuKdjCDmnIjmrKHliLbpmZDliLDpgZRcIik7XHJcbiAgICAgIG5ldyBOb3RpY2UoXCJYIEFQSeaciOasoeWItumZkCgxMDAgcmVhZHMp44Gr5Yiw6YGU44GX44G+44GX44Gf44CC57+M5pyI44G+44Gn5b6F5qmf44GX44Gm44GP44Gg44GV44GE44CCXCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLmNhY2hlZFVzZXJJZCkge1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MuY2FjaGVkVXNlcklkID0gYXdhaXQgZmV0Y2hVc2VySWQodXNlcm5hbWUsIHJlcXVlc3RVcmwsIGJlYXJlclRva2VuKTtcclxuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB0d2VldHMgPSBhd2FpdCBmZXRjaFR3ZWV0cyh0aGlzLnNldHRpbmdzLmNhY2hlZFVzZXJJZCwgYmVhcmVyVG9rZW4sIHJlcXVlc3RVcmwpO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5jcmVtZW50IHVzYWdlIGNvdW50ZXIgb24gc3VjY2Vzc2Z1bCBBUEkgY2FsbFxyXG4gICAgICB0aGlzLnNldHRpbmdzLm1vbnRobHlSZXF1ZXN0Q291bnQrKztcclxuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICAgICAgXHJcbiAgICAgIGxldCBuID0gMDtcclxuICAgICAgY29uc3QgYSA9IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXI7XHJcbiAgICAgIGZvciAoY29uc3QgdCBvZiB0d2VldHMpIHtcclxuICAgICAgICBjb25zdCBkaXIgPSBgJHt0LmNyZWF0ZWRfYXQuc2xpY2UoMCwgMTApLnJlcGxhY2UoLy0vZywgXCIvXCIpfS9gO1xyXG4gICAgICAgIGNvbnN0IHBhdGggPSBgJHtkaXJ9JHt0LmlkfS5tZGA7XHJcbiAgICAgICAgaWYgKGF3YWl0IGEuZXhpc3RzKHBhdGgpKSBjb250aW51ZTtcclxuICAgICAgICBhd2FpdCBhLm1rZGlyKGRpcikuY2F0Y2goKCkgPT4ge30pO1xyXG4gICAgICAgIGF3YWl0IGEud3JpdGUocGF0aCwgdHdlZXRUb01hcmtkb3duKHQpKTtcclxuICAgICAgICBuKys7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zdGF0dXMuc2V0VGV4dChgWFBvc3RzU3luYyDinIUgJHtufSAoJHt0aGlzLnNldHRpbmdzLm1vbnRobHlSZXF1ZXN0Q291bnR9LzEwMClgKTtcclxuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGUubWVzc2FnZSAmJiBlLm1lc3NhZ2UuaW5jbHVkZXMoXCJSYXRlIGxpbWl0IGV4Y2VlZGVkXCIpKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMuc2V0VGV4dChcIuKPsCBSYXRlIGxpbWl0XCIpO1xyXG4gICAgICAgIG5ldyBOb3RpY2UoXCJSYXRlIGxpbWl05Yiw6YGU44CCMTXliIblvozjgavlho3oqabooYzjgZfjgabjgY/jgaDjgZXjgYTjgIJcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbmV3IE5vdGljZShcIlhQb3N0c1N5bmMgZXJyb3I6IFwiICsgZS5tZXNzYWdlKTtcclxuICAgICAgICB0aGlzLnN0YXR1cy5zZXRUZXh0KFwiWFBvc3RzU3luYyDinYwgZXJyb3JcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFRhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gIHBsdWdpbjogWFBvc3RzU3luYztcclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBYUG9zdHNTeW5jKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcbiAgZGlzcGxheSgpOiB2b2lkIHtcclxuICAgIGNvbnN0IGMgPSB0aGlzLmNvbnRhaW5lckVsO1xyXG4gICAgYy5lbXB0eSgpO1xyXG4gICAgYy5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogXCJYIFBvc3RzIFN5bmNcIiB9KTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoYylcclxuICAgICAgLnNldE5hbWUoXCLwn5OKIFggQVBJ5L2/55So54q25rOBXCIpXHJcbiAgICAgIC5zZXREZXNjKGDku4rmnIjjga7kvb/nlKjph486ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3MubW9udGhseVJlcXVlc3RDb3VudH0vMTAwIHJlYWRzYCk7XHJcbiAgICBcclxuICAgIG5ldyBTZXR0aW5nKGMpXHJcbiAgICAgIC5zZXROYW1lKFwi4pqg77iPIEZyZWUgVGllcuWItumZkFwiKVxyXG4gICAgICAuc2V0RGVzYyhcIuaciDEwMOODquOCr+OCqOOCueODiOOBvuOBp+OAgui2hemBjuaZguOBr+e/jOaciOOBvuOBp+W+heapn+OBjOW/heimgeOBp+OBmeOAglwiKTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoYylcclxuICAgICAgLnNldE5hbWUoXCJCZWFyZXIgVG9rZW5cIilcclxuICAgICAgLmFkZFRleHQodCA9PiB0XHJcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmJlYXJlclRva2VuKVxyXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyB2ID0+IHtcclxuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJlYXJlclRva2VuID0gdi50cmltKCk7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIG5ldyBTZXR0aW5nKGMpXHJcbiAgICAgIC5zZXROYW1lKFwiVXNlcm5hbWUgKEDnhKHjgZcpXCIpXHJcbiAgICAgIC5hZGRUZXh0KHQgPT4gdFxyXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VybmFtZSlcclxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgdiA9PiB7XHJcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VybmFtZSA9IHYudHJpbSgpO1xyXG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY2FjaGVkVXNlcklkID0gXCJcIjtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgbmV3IFNldHRpbmcoYylcclxuICAgICAgLnNldE5hbWUoXCJJbnRlcnZhbCAobWluKVwiKVxyXG4gICAgICAuYWRkVGV4dCh0ID0+IHRcclxuICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLmludGVydmFsKSlcclxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgdiA9PiB7XHJcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbnRlcnZhbCA9IHBhcnNlSW50KHYpIHx8IDYwO1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIlBsdWdpbiIsIk5vdGljZSIsInJlcXVlc3RVcmwiLCJQbHVnaW5TZXR0aW5nVGFiIiwiU2V0dGluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFxREE7QUFDTyxTQUFTLFNBQVMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUU7QUFDN0QsSUFBSSxTQUFTLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLEtBQUssWUFBWSxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7QUFDaEgs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
